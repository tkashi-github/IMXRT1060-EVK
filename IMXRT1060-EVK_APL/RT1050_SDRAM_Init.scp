   1 REM cmresetvectorcatchset this
   2 REM cmsysresetreq this
   3 REM wireswdconnect this
   4 REM cmclearerrors this
   5 REM cminitapdp this 
  10 rem ---------------------------------
  20 Print "RT1050 SDRAM Initialisation"
  30 rem ---------------------------------
  40 REM Enable all clocks 
  50 POKE32 THIS 0x400FC068 0xFFFFFFFF
  60 POKE32 THIS 0x400FC06C 0xFFFFFFFF
  70 POKE32 THIS 0x400FC070 0xFFFFFFFF
  80 POKE32 THIS 0x400FC074 0xFFFFFFFF
  90 POKE32 THIS 0x400FC078 0xFFFFFFFF
 100 POKE32 THIS 0x400FC07C 0xFFFFFFFF
 110 POKE32 THIS 0x400FC080 0xFFFFFFFF
 120 REM    
 121 POKE32 THIS 0x400D8050 0x00000000
 122 POKE32 THIS 0x400D8060 0x00000100
 130 POKE32 THIS 0x400D8030 0x00002001
 140 POKE32 THIS 0x400D8100 0x001d0000
 150 POKE32 THIS 0x400FC014 0x00010D40
 160 Print "Clock Init Done"   
 170 REM ========================================================    
 180 REM Set SDRAM  
 190 REM Config IOMUX for SDRAM - EMC_00 to EMC_41   
 200 POKE32 THIS 0x401F8014 0x0
 210 POKE32 THIS 0x401F8018 0x0
 220 POKE32 THIS 0x401F801C 0x0
 230 POKE32 THIS 0x401F8020 0x0
 240 POKE32 THIS 0x401F8024 0x0
 250 POKE32 THIS 0x401F8028 0x0
 260 POKE32 THIS 0x401F802C 0x0
 270 POKE32 THIS 0x401F8030 0x0
 280 POKE32 THIS 0x401F8034 0x0
 290 POKE32 THIS 0x401F8038 0x0
 300 POKE32 THIS 0x401F803C 0x0
 310 POKE32 THIS 0x401F8040 0x0
 320 POKE32 THIS 0x401F8044 0x0
 330 POKE32 THIS 0x401F8048 0x0
 340 POKE32 THIS 0x401F804C 0x0
 350 POKE32 THIS 0x401F8050 0x0
 360 POKE32 THIS 0x401F8054 0x0
 370 POKE32 THIS 0x401F8058 0x0
 380 POKE32 THIS 0x401F805C 0x0
 390 POKE32 THIS 0x401F8060 0x0
 400 POKE32 THIS 0x401F8064 0x0
 410 POKE32 THIS 0x401F8068 0x0
 420 POKE32 THIS 0x401F806C 0x0
 430 POKE32 THIS 0x401F8070 0x0
 440 POKE32 THIS 0x401F8074 0x0
 450 POKE32 THIS 0x401F8078 0x0
 460 POKE32 THIS 0x401F807C 0x0
 470 POKE32 THIS 0x401F8080 0x0
 480 POKE32 THIS 0x401F8084 0x0
 490 POKE32 THIS 0x401F8088 0x0
 500 POKE32 THIS 0x401F808C 0x0
 510 POKE32 THIS 0x401F8090 0x0
 520 POKE32 THIS 0x401F8094 0x0
 530 POKE32 THIS 0x401F8098 0x0
 540 POKE32 THIS 0x401F809C 0x0
 550 POKE32 THIS 0x401F80A0 0x0
 560 POKE32 THIS 0x401F80A4 0x0
 570 POKE32 THIS 0x401F80A8 0x0
 580 POKE32 THIS 0x401F80AC 0x0
 590 REM DQS PIN, enable SION   
 600 POKE32 THIS 0x401F80B0 0x10
 610 POKE32 THIS 0x401F80B4 0x0
 620 POKE32 THIS 0x401F80B8 0x0
 630 REM  PAD ctrl   
 640 REM drive strength = 0x7 to increase otherwise the data 7 bit may fail   
 650 REM EMC_00 to EMC_41   
 660 REM   
 670 POKE32 THIS 0x401F8204 0x000110F9
 680 POKE32 THIS 0x401F8208 0x000110F9
 690 POKE32 THIS 0x401F820C 0x000110F9
 700 POKE32 THIS 0x401F8210 0x000110F9
 710 POKE32 THIS 0x401F8214 0x000110F9
 720 POKE32 THIS 0x401F8218 0x000110F9
 730 POKE32 THIS 0x401F821C 0x000110F9
 740 POKE32 THIS 0x401F8220 0x000110F9
 750 POKE32 THIS 0x401F8224 0x000110F9
 760 POKE32 THIS 0x401F8228 0x000110F9
 770 POKE32 THIS 0x401F822C 0x000110F9
 780 POKE32 THIS 0x401F8230 0x000110F9
 790 POKE32 THIS 0x401F8234 0x000110F9
 800 POKE32 THIS 0x401F8238 0x000110F9
 810 POKE32 THIS 0x401F823C 0x000110F9
 820 POKE32 THIS 0x401F8240 0x000110F9
 830 POKE32 THIS 0x401F8244 0x000110F9
 840 POKE32 THIS 0x401F8248 0x000110F9
 850 POKE32 THIS 0x401F824C 0x000110F9
 860 POKE32 THIS 0x401F8250 0x000110F9
 870 POKE32 THIS 0x401F8254 0x000110F9
 880 POKE32 THIS 0x401F8258 0x000110F9
 890 POKE32 THIS 0x401F825C 0x000110F9
 900 POKE32 THIS 0x401F8260 0x000110F9
 910 POKE32 THIS 0x401F8264 0x000110F9
 920 POKE32 THIS 0x401F8268 0x000110F9
 930 POKE32 THIS 0x401F826C 0x000110F9
 940 POKE32 THIS 0x401F8270 0x000110F9
 950 POKE32 THIS 0x401F8274 0x000110F9
 960 POKE32 THIS 0x401F8278 0x000110F9
 970 POKE32 THIS 0x401F827C 0x000110F9
 980 POKE32 THIS 0x401F8280 0x000110F9
 990 POKE32 THIS 0x401F8284 0x000110F9
1000 POKE32 THIS 0x401F8288 0x000110F9
1010 POKE32 THIS 0x401F828C 0x000110F9
1020 POKE32 THIS 0x401F8290 0x000110F9
1030 POKE32 THIS 0x401F8294 0x000110F9
1040 POKE32 THIS 0x401F8298 0x000110F9
1050 POKE32 THIS 0x401F829C 0x000110F9
1060 POKE32 THIS 0x401F82A0 0x000110F9
1070 POKE32 THIS 0x401F82A4 0x000110F9
1080 POKE32 THIS 0x401F82A8 0x000110F9
1090 REM ========================================================   
1100 REM Config SDR Controller Registers   
1110 REM MCR,BMCR0,BMCR1,BR0 32MB,BR1 32MB,BR2 32MB,BR3 32MB,BR4,BR5,BR5,BR6,BR7,BR8   
1120 REM   
1130 POKE32 THIS 0x402F0000 0x10000004
1140 REM POKE32 THIS 0x402F0004 0x000079A8
1150 POKE32 THIS 0x402F0008 0x00030524
1160 POKE32 THIS 0x402F000C 0x06030524
1170 POKE32 THIS 0x402F0010 0x8000001B
1180 POKE32 THIS 0x402F0014 0x8200001B
1190 POKE32 THIS 0x402F0018 0x8400001B
1200 POKE32 THIS 0x402F001C 0x8600001B
1210 POKE32 THIS 0x402F0020 0x90000021
1220 POKE32 THIS 0x402F0024 0xA0000019
1230 POKE32 THIS 0x402F0028 0xA8000017
1240 POKE32 THIS 0x402F002C 0xA900001B
1250 POKE32 THIS 0x402F0030 0x00000021
1260 REM IOCR,SEMC_CCSX0 as NOR CE, SEMC_CSX1 as PSRAM CE, SEMC_CSX2 as NAND CE, SEMC_CSX3 as DBI CE.   
1270 POKE32 THIS 0x402F0004 0x000079A8
1280 REM ========================================================   
1290 REM SDRAMCR0,SDRAMCR1,SDRAMCR2,SDRAMCR3   
1300 POKE32 THIS 0x402F0040 0x00000F31
1310 POKE32 THIS 0x402F0044 0x00652922
1320 POKE32 THIS 0x402F0048 0x00010920
1330 POKE32 THIS 0x402F004C 0x50210A08
1340 REM DBICR0,DBICR1,IPCR1,IPCR2   
1350 POKE32 THIS 0x402F0080 0x00000021
1360 POKE32 THIS 0x402F0084 0x00888888
1370 POKE32 THIS 0x402F0090 0x00000002
1380 POKE32 THIS 0x402F0098 0x00000000
1390 REM IPCR0,IPCMD, SD_CC_IPREA   
1400 POKE32 THIS 0x402F0090 0x80000000
1410 POKE32 THIS 0x402F009C 0xA55A000F
1420 REPEAT   
1430 m% = PEEK32 THIS 0x402F003C 
1440 UNTIL m% & 0x3 != 0   
1450 REM IPCR0,SD_CC_IAF   
1460 POKE32 THIS 0x402F0090 0x80000000
1470 POKE32 THIS 0x402F009C 0xA55A000C
1480 REPEAT   
1490 m% = PEEK32 THIS 0x402F003C 
1500 UNTIL m% & 0x3 != 0   
1510 REM IPCR0,SD_CC_IAF   
1520 POKE32 THIS 0x402F0090 0x80000000
1530 POKE32 THIS 0x402F009C 0xA55A000C
1540 REPEAT   
1550 m% = PEEK32 THIS 0x402F003C 
1560 UNTIL m% & 0x3 != 0   
1570 REM IPTXDAT,UPCR0,SD_CC_IMS   
1580 POKE32 THIS 0x402F00A0 0x00000033
1590 POKE32 THIS 0x402F0090 0x80000000
1600 POKE32 THIS 0x402F009C 0xA55A000A
1610 REPEAT   
1620 m% = PEEK32 THIS 0x402F003C 
1630 UNTIL m% & 0x3 != 0   
1640 REM enable sdram self refresh again after initialization done   
1650 POKE32 THIS 0x402F004C 0x50210A09
1660 Print "SDRAM Init Done"   
1670 REM ===================================
1680 REM This sequence disables the MPU 
1690 REM ===================================
1700 print "IMXRT MPU Disable"
1710 p% = probefirstfound
1720 selectprobecore p% 0
1730 s% = Peek32 this 0xE000ED94
1740 s% = s% & 0xFFFFFFFE
1750 Poke32 this 0xE000ED94 s%
1760 print "Finished"
1770 End

